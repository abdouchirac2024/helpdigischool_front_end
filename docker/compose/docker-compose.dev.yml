# ============================================
# Help Digi School - Docker Compose Development
# ============================================
# Usage: make up-dev
# ============================================

services:
  frontend:
    build:
      context: ../..
      dockerfile: docker/Dockerfile.dev
    container_name: helpdigischool-frontend-dev
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
      - "${DEBUG_PORT:-9229}:9229"
    volumes:
      - ../..:/app:cached
      - /app/node_modules
      - nextjs-cache:/app/.next
    environment:
      # Surcharge pour Docker: host.docker.internal permet d'accéder au backend sur la machine hôte
      - NEXT_PUBLIC_API_URL=http://host.docker.internal:8080/api/v1
    env_file:
      - ../../.env.local
    extra_hosts:
      # Requis pour Linux (host.docker.internal n'est pas natif sur Linux)
      - "host.docker.internal:host-gateway"
    healthcheck:
      start_period: 60s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.helpdigischool-dev.rule=Host(`helpdigischool.localhost`)"
      - "traefik.http.routers.helpdigischool-dev.entrypoints=web"
      - "traefik.http.services.helpdigischool-dev.loadbalancer.server.port=3000"

networks:
  default:
    name: helpdigischool-network-dev
  traefik:
    external: true
    name: traefik-dev

volumes:
  nextjs-cache: