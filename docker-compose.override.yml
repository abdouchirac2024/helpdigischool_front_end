# ============================================
# Help Digi School - Override Développement
# ============================================
# Ce fichier est chargé automatiquement avec docker-compose.yml
# Pour utiliser un autre environnement:
#   docker-compose -f docker-compose.yml -f docker-compose.preprod.yml up
# ============================================

services:
  frontend:
    build:
      target: development
    container_name: helpdigischool-frontend-dev
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
      - "${DEBUG_PORT:-9229}:9229"  # Node.js debugger
    volumes:
      # Code source avec hot-reload
      - .:/app:cached
      # Préserver node_modules du container
      - /app/node_modules
      # Cache Next.js persistant
      - nextjs-cache:/app/.next
      # Scripts Docker
      - ./docker/scripts:/app/docker/scripts:ro
    environment:
      - NODE_ENV=development
      - ENVIRONMENT=dev
      - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-http://localhost:8080/api/v1}
      - NEXT_PUBLIC_APP_NAME=${NEXT_PUBLIC_APP_NAME:-Help Digi School}
      - NEXT_PUBLIC_APP_URL=${NEXT_PUBLIC_APP_URL:-http://localhost:3000}
      - NEXT_PUBLIC_ENVIRONMENT=development
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    env_file:
      - .env.local
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3000/api/health"]
      start_period: 60s
    labels:
      - "com.helpdigischool.environment=development"

volumes:
  nextjs-cache:
