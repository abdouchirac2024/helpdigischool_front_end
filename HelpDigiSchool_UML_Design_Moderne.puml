@startuml HelpDigiSchool_Complet_Final

'========================================
' CONFIGURATION DESIGN PROFESSIONNEL
'========================================

!theme vibrant from https://raw.githubusercontent.com/plantuml/plantuml/master/themes

' Layout optimisé
skinparam linetype ortho
skinparam nodesep 70
skinparam ranksep 80
skinparam padding 2
skinparam roundcorner 8

' Arrière-plan et style général
skinparam backgroundColor #F8FAFB
skinparam shadowing true
skinparam handwritten false
skinparam monochrome false

' Style des packages
skinparam packageStyle rectangle
skinparam package {
  BackgroundColor gradient #FFFFFF-#F5F7FA
  BorderColor #2C3E50
  BorderThickness 2.5
  FontSize 11
  FontStyle bold
  FontColor #1A202C
  Shadowing true
}

' Style des classes
skinparam class {
  BackgroundColor gradient #FFFFFF-#F9FAFB
  BorderColor #4A5568
  BorderThickness 2
  FontSize 10
  FontName Segoe UI
  FontColor #2D3748
  HeaderBackgroundColor gradient #667EEA-#764BA2
  HeaderFontColor #FFFFFF
  HeaderFontSize 11
  HeaderFontStyle bold
  AttributeFontSize 9
  AttributeFontColor #4A5568
  StereotypeFontSize 9
  ArrowColor #4A5568
  ArrowThickness 1.8
  Shadowing true
}

' Style des classes abstraites
skinparam class<<abstract>> {
  BackgroundColor gradient #FFF5F5-#FED7D7
  BorderColor #C53030
  BorderThickness 2.5
  FontStyle italic bold
}

' Style des enums
skinparam enum {
  BackgroundColor gradient #FFFAF0-#FBD38D
  BorderColor #DD6B20
  BorderThickness 2
  FontSize 9
  FontColor #744210
  FontStyle bold
  AttributeFontSize 8
  Shadowing true
}

' Style des relations
skinparam ArrowColor #718096
skinparam ArrowThickness 1.8
skinparam ArrowFontSize 9
skinparam ArrowFontColor #4A5568

' Style du titre
skinparam titleFontSize 16
skinparam titleFontStyle bold
skinparam titleFontColor #1A202C
skinparam titleBackgroundColor gradient #667EEA-#764BA2
skinparam titleBorderColor #4C51BF
skinparam titleBorderThickness 3
skinparam titleBorderRoundCorner 10

' Style des notes et légendes
skinparam noteFontSize 9
skinparam noteBorderColor #4A5568
skinparam noteBackgroundColor #FFFEF7
skinparam noteShadowing true

' Style des stéréotypes
skinparam stereotypeCBackgroundColor #EDF2F7
skinparam stereotypeEBackgroundColor #FED7D7

title HelpDigiSchool - Architecture Multi-Tenant SaaS\nÉcoles Maternelles & Primaires - Cameroun\n(Version Production Ready - Complète)

enum TypeSecteur {
  PRIVE
  PUBLIC
}

enum TypeEnseignement {
  MATERNELLE
  PRIMAIRE
  SECONDAIRE_1ER_CYCLE
  SECONDAIRE_2EME_CYCLE
}

enum StatutTenant {
  EN_ATTENTE_VERIFICATION
  VALIDE_EN_ATTENTE_FORFAIT
  ACTIF
  SUSPENDU
  EXPIRE
  REJETE
}

enum StatutPaiement {
  EN_ATTENTE
  EN_COURS
  COMPLETE
  ECHOUE
  REMBOURSE
  ANNULE
}

enum Genre {
  MASCULIN
  FEMININ
}

enum StatutEleve {
  INSCRIT
  ACTIF
  SUSPENDU
  TRANSFERE
  DIPLOME
  ABANDONNE
  RADIE
  EXCLU
}

enum RoleUtilisateur {
  SUPER_ADMIN
  ADMIN_ECOLE
  ENSEIGNANT
  ELEVE
  PARENT
  SECRETAIRE
  COMPTABLE
  AGENT_TRANSPORT
  BIBLIOTHECAIRE
}

enum TypeAdresse {
  DOMICILE
  TRAVAIL
  ETABLISSEMENT
  AUTRE
}

package "Plateforme Multi-Tenant" <<Infrastructure>> #E3F2FD {
  
  class Region {
    +id: UUID
    +nom: String
    +code: String
    +paysCode: String
    +ordreAffichage: Integer
  }
  
  class Departement {
    +id: UUID
    +regionId: UUID
    +nom: String
    +code: String
    +chefLieu: String
  }
  
  class Tenant {
    +id: UUID
    +tenantId: String
    +nomEcole: String
    +codeEcole: String
    +sousDomaine: String
    +typeSecteur: TypeSecteur
    +statut: StatutTenant
    +forfaitAbonnementId: UUID
    +adresseId: UUID
    +emailContact: String
    +telephoneContact: String
    +telephoneSecondaire: String
    +nombreElevesEstime: Integer
    +nombreElevesActuels: Integer
    +logoUrl: String
    +siteWeb: String
    +dateCreation: DateTime
    +dateExpiration: DateTime
    +estActif: Boolean
    +dernierPaiement: DateTime
    --
    +activer(): void
    +suspendre(motif: String): void
    +verifierAbonnement(): Boolean
    +obtenirTypesEnseignement(): List
    +calculerTauxOccupation(): Decimal
    +estDansLimites(): Boolean
  }
  
  class TenantTypeEnseignement {
    +id: UUID
    +tenantId: UUID
    +typeEnseignement: TypeEnseignement
    +dateDebut: Date
    +dateFin: Date
    +estActif: Boolean
  }
  
  class ForfaitAbonnement {
    +id: UUID
    +nom: String
    +description: String
    +prix: Decimal
    +devise: String
    +periodeFacturation: String
    +maxEleves: Integer
    +maxEnseignants: Integer
    +maxClasses: Integer
    +stockageGo: Integer
    +smsParMois: Integer
    +fonctionnalites: JSON
    +estActif: Boolean
    +ordreAffichage: Integer
    --
    +calculerPrixPeriode(periode: String): Decimal
    +verifierLimites(nbEleves: Integer, nbEnseignants: Integer): Boolean
    +aFonctionnalite(nom: String): Boolean
  }
  
  class Paiement {
    +id: UUID
    +tenantId: UUID
    +forfaitAbonnementId: UUID
    +montant: Decimal
    +devise: String
    +methodePaiement: String
    +operateurMobileMoney: String
    +numeroTelephone: String
    +idTransaction: String
    +numeroReference: String
    +statut: StatutPaiement
    +datePaiement: DateTime
    +dateValidation: DateTime
    +payePar: UUID
    +validePar: UUID
    +raisonEchec: String
    +nombreTentatives: Integer
    --
    +traiterPaiement(): Boolean
    +genererFacture(): Facture
    +annuler(): void
    +verifierStatut(): StatutPaiement
  }
  
  class Facture {
    +id: UUID
    +numeroFacture: String
    +tenantId: UUID
    +paiementId: UUID
    +montantHT: Decimal
    +montantTVA: Decimal
    +tauxTVA: Decimal
    +montantTTC: Decimal
    +dateEmission: DateTime
    +dateEcheance: DateTime
    +datePaiement: DateTime
    +statut: String
    +urlPdf: String
    +emailEnvoi: String
    +dateEnvoi: DateTime
    --
    +genererPDF(): String
    +marquerPayee(): void
    +envoyer(): void
    +telecharger(): ByteArray
  }
  
  Region "1" *-- "1..*" Departement
  Tenant "0..*" -- "1" Departement
  Tenant "1" *-- "1..*" TenantTypeEnseignement
  TenantTypeEnseignement "0..*" -- "1" TypeEnseignement
  Tenant "0..*" -- "1" ForfaitAbonnement
  Tenant "1" *-- "0..*" Paiement
  Paiement "0..*" -- "1" ForfaitAbonnement
  Paiement "1" -- "1" Facture
}

package "Localisation" <<Core>> #E8F5E9 {
  
  class Adresse {
    +id: UUID
    +ligneAdresse1: String
    +ligneAdresse2: String
    +quartier: String
    +villeNom: String
    +departementId: UUID
    +codePostal: String
    +boitePostale: String
    +pays: String
    +latitude: Double
    +longitude: Double
    +precision: Integer
    +typeAdresse: TypeAdresse
    +estPrincipale: Boolean
    +estValidee: Boolean
    +dateCreation: DateTime
    +dateValidation: DateTime
    --
    +formaterComplete(): String
    +calculerDistance(autre: Adresse): Decimal
    +estDansRayon(lat: Double, lon: Double, rayonKm: Decimal): Boolean
    +obtenirCoordonnees(): Point
    +valider(): void
  }
  
  Adresse "0..*" -- "1" Departement
  Tenant "1" -- "1" Adresse
}

package "Utilisateurs (RBAC)" <<Security>> #FFF3E0 {
  
  abstract class Utilisateur {
    +id: UUID
    +tenantId: UUID
    +nomUtilisateur: String
    +email: String
    +motDePasse: String
    +nom: String
    +prenom: String
    +telephone: String
    +telephoneSecondaire: String
    +role: RoleUtilisateur
    +estActif: Boolean
    +estVerifie: Boolean
    +derniereConnexion: DateTime
    +dateCreation: DateTime
    +dateModification: DateTime
    +photoProfil: String
    +langue: String
    +tokenReinitialisation: String
    +dateExpirationToken: DateTime
    --
    +authentifier(password: String): Boolean
    +changerMotDePasse(ancien: String, nouveau: String): Boolean
    +mettreAJourProfil(data: Map): void
    +desactiver(): void
    +activer(): void
    +nomComplet(): String
    +reinitialiserMotDePasse(): String
  }
  
  class AdminEcole {
    +matriculeEmploye: String
    +departement: String
    +fonction: String
    +dateEmbauche: Date
    +dateFinContrat: Date
    +typeContrat: String
    +salaire: Decimal
    --
    +gererUtilisateurs(): void
    +genererRapports(): List
    +configurerEcole(): void
    +validerInscriptions(): void
    +approuverPaiements(): void
  }
  
  class Enseignant {
    +matriculeEmploye: String
    +numeroMatricule: String
    +specialisation: String
    +diplome: String
    +niveauEtudes: String
    +dateEmbauche: Date
    +dateFinContrat: Date
    +salaire: Decimal
    +statut: String
    +typeContrat: String
    +numeroSecuriteSociale: String
    --
    +saisirNotes(evaluation: Evaluation): void
    +faireAppel(cours: Cours, date: Date): void
    +obtenirChargeHoraire(): Integer
    +redigerAppreciation(bulletin: Bulletin): void
    +consulterEmploiDuTemps(): List
    +obtenirClasses(): List
  }
  
  class Eleve {
    +matricule: String
    +dateNaissance: Date
    +lieuNaissanceVille: String
    +lieuNaissancePays: String
    +genre: Genre
    +nationalite: String
    +adresseId: UUID
    +infosMedicales: String
    +groupeSanguin: String
    +allergies: String
    +handicaps: String
    +traitementsMedicaux: String
    +contactUrgenceNom: String
    +contactUrgenceTelephone: String
    +nomPere: String
    +telephonePere: String
    +professionPere: String
    +emailPere: String
    +nomMere: String
    +telephoneMere: String
    +professionMere: String
    +emailMere: String
    +nomTuteur: String
    +telephoneTuteur: String
    +lienTuteur: String
    +dateInscription: Date
    +anneePremiereinscription: String
    +statut: StatutEleve
    +photoIdentite: String
    +extraitNaissance: String
    +certificatMedical: String
    +ficheRenseignement: String
    --
    +age(): Integer
    +inscrire(classe: Classe): void
    +transferer(nouvelleClasse: Classe): void
    +estAJourScolarite(): Boolean
    +obtenirParents(): List
    +obtenirAdresseComplete(): String
    +estDansQuartier(quartier: String): Boolean
    +calculerMoyenneGenerale(periode: Periode): Decimal
  }
  
  class Parent {
    +profession: String
    +employeur: String
    +adresseId: UUID
    +situationMatrimoniale: String
    +revenuMensuel: Decimal
    +nombreEnfants: Integer
    --
    +consulterBulletin(eleve: Eleve, periode: Periode): Bulletin
    +effectuerPaiement(frais: FraisEleve): Transaction
    +envoyerMessage(destinataire: Utilisateur, contenu: String): Message
    +consulterPresences(eleve: Eleve, dateDebut: Date, dateFin: Date): List
    +obtenirEnfants(): List
    +obtenirAdresses(): List
    +ajouterAdresse(adresse: Adresse, estPrincipale: Boolean): void
  }
  
  class Secretaire {
    +matriculeEmploye: String
    +departement: String
    +dateEmbauche: Date
    +fonction: String
    --
    +enregistrerInscription(eleve: Eleve): void
    +genererCertificat(eleve: Eleve, type: String): Document
    +gererScolarite(): void
    +imprimerBulletins(classe: Classe, periode: Periode): void
  }
  
  class Comptable {
    +matriculeEmploye: String
    +numeroAgrement: String
    +dateEmbauche: Date
    +specialisation: String
    --
    +validerPaiement(transaction: Transaction): void
    +genererBilanFinancier(dateDebut: Date, dateFin: Date): Rapport
    +suivreRecouvrement(): List
    +genererEtatFinancier(periode: Periode): Document
    +exporterComptabilite(): ByteArray
  }
  
  class AgentTransport {
    +matriculeEmploye: String
    +numeroPermis: String
    +typePermis: String
    +dateObtentionPermis: Date
    +dateExpirationPermis: Date
    +busAffecteId: UUID
    +dateAffectation: Date
    --
    +pointeEleve(eleve: Eleve, trajet: Trajet): void
    +suivreTrajet(trajet: Trajet): void
    +signalerIncident(description: String): Incident
    +commencerTrajet(): void
    +terminerTrajet(): void
  }
  
  class Bibliothecaire {
    +matriculeEmploye: String
    +dateEmbauche: Date
    +specialisation: String
    --
    +enregistrerPret(livre: Livre, eleve: Eleve): PretLivre
    +enregistrerRetour(pret: PretLivre): void
    +suivreRetards(): List
    +gererStock(): void
    +genererStatistiques(): Rapport
  }
  
  class EleveParent {
    +id: UUID
    +eleveId: UUID
    +parentId: UUID
    +lienParente: String
    +estContactPrincipal: Boolean
    +estTuteurLegal: Boolean
    +autorisationRecuperation: Boolean
    +autorisationSortie: Boolean
    +dateDebut: Date
    +dateFin: Date
    +estActif: Boolean
  }
  
  class ParentAdresse {
    +id: UUID
    +parentId: UUID
    +adresseId: UUID
    +estPrincipale: Boolean
    +typeAdresse: TypeAdresse
    +dateDebut: Date
    +dateFin: Date
  }
  
  Utilisateur <|-- AdminEcole
  Utilisateur <|-- Enseignant
  Utilisateur <|-- Eleve
  Utilisateur <|-- Parent
  Utilisateur <|-- Secretaire
  Utilisateur <|-- Comptable
  Utilisateur <|-- AgentTransport
  Utilisateur <|-- Bibliothecaire
  
  Tenant "1" *-- "0..*" Utilisateur
  Eleve "1" -- "0..*" EleveParent
  Parent "1" -- "0..*" EleveParent
  Eleve "0..*" -- "0..1" Adresse
  Parent "1" -- "1..*" ParentAdresse
  ParentAdresse "0..*" -- "1" Adresse
}

package "Structure Académique" <<Domain>> #F3E5F5 {
  
  class AnneeScolaire {
    +id: UUID
    +tenantId: UUID
    +libelle: String
    +dateDebut: Date
    +dateFin: Date
    +estCourante: Boolean
    +statut: String
    +dateCreation: DateTime
    +dateOuverture: DateTime
    +dateCloture: DateTime
    +cloturePar: UUID
    --
    +activer(): void
    +cloturer(): void
    +verifierChevauchement(): Boolean
    +obtenirPeriodes(): List
    +estActive(): Boolean
  }
  
  class Periode {
    +id: UUID
    +tenantId: UUID
    +anneeScolaireId: UUID
    +nom: String
    +type: String
    +dateDebut: Date
    +dateFin: Date
    +ordreIndex: Integer
    +estCloturee: Boolean
    +dateCloture: DateTime
    +cloturePar: UUID
    --
    +contient(date: Date): Boolean
    +cloturer(): void
    +genererBulletins(): void
    +obtenirDureeJours(): Integer
  }
  
  class Niveau {
    +id: UUID
    +nom: String
    +code: String
    +typeEnseignement: TypeEnseignement
    +ordre: Integer
    +ageMin: Integer
    +ageMax: Integer
    +description: String
    +abreviation: String
  }
  
  class Salle {
    +id: UUID
    +tenantId: UUID
    +code: String
    +nom: String
    +capacite: Integer
    +batiment: String
    +etage: Integer
    +superficie: Decimal
    +typeEquipement: String
    +equipements: JSON
    +estDisponible: Boolean
    --
    +estDisponible(jour: String, heureDebut: Time, heureFin: Time): Boolean
    +reserver(cours: Cours, jour: String, heure: Time): void
    +liberer(): void
  }
  
  class Classe {
    +id: UUID
    +tenantId: UUID
    +nom: String
    +niveauId: UUID
    +salleId: UUID
    +section: String
    +capacite: Integer
    +effectif: Integer
    +enseignantPrincipalId: UUID
    +anneeScolaireId: UUID
    +estActive: Boolean
    --
    +inscrireEleve(eleve: Eleve): Boolean
    +retirerEleve(eleve: Eleve): void
    +obtenirNombreEleves(): Integer
    +moyenneClasse(periode: Periode): Decimal
    +estComplete(): Boolean
    +obtenirEleves(): List
    +obtenirCours(): List
  }
  
  class GroupeDiscipline {
    +id: UUID
    +tenantId: UUID
    +nom: String
    +code: String
    +description: String
    +ordreAffichage: Integer
    +couleur: String
    +icone: String
    +estActif: Boolean
  }
  
  class Matiere {
    +id: UUID
    +tenantId: UUID
    +groupeDisciplineId: UUID
    +nom: String
    +code: String
    +coefficient: Decimal
    +categorie: String
    +couleur: String
    +description: String
    +abreviation: String
    +estObligatoire: Boolean
    --
    +calculerNotePonderee(note: Decimal): Decimal
  }
  
  class Cours {
    +id: UUID
    +tenantId: UUID
    +classeId: UUID
    +matiereId: UUID
    +enseignantId: UUID
    +anneeScolaireId: UUID
    +libelle: String
    +description: String
    +volumeHoraire: Integer
    +volumeHoraireEffectue: Integer
    +objectifs: String
    +programme: String
    +estActif: Boolean
    --
    +obtenirEleves(): List
    +obtenirEvaluations(): List
    +calculerProgressionProgramme(): Decimal
  }
  
  class EmploiDuTemps {
    +id: UUID
    +tenantId: UUID
    +coursId: UUID
    +jourSemaine: String
    +heureDebut: Time
    +heureFin: Time
    +salleId: UUID
    +recurrence: String
    +dateDebut: Date
    +dateFin: Date
    +estActif: Boolean
    --
    +verifierConflits(): Boolean
    +calculerDuree(): Integer
    +estAujourdui(): Boolean
  }
  
  Tenant "1" *-- "1..*" AnneeScolaire
  Tenant "1" *-- "0..*" Salle
  Tenant "1" *-- "0..*" GroupeDiscipline
  Tenant "1" *-- "0..*" Matiere
  
  AnneeScolaire "1" *-- "1..*" Periode
  AnneeScolaire "1" *-- "0..*" Classe
  
  Niveau "1" -- "0..*" Classe
  Niveau "0..*" -- "1" TypeEnseignement
  
  Classe "0..*" -- "0..1" Salle
  Classe "1" -- "0..*" Eleve
  Classe "0..*" -- "0..1" Enseignant
  
  GroupeDiscipline "1" -- "0..*" Matiere
  
  Cours "1" -- "1" Matiere
  Cours "1" -- "1" Classe
  Cours "1" -- "1" Enseignant
  Cours "1" *-- "0..*" EmploiDuTemps
  
  EmploiDuTemps "0..*" -- "0..1" Salle
}

package "Évaluations & Notes" <<Academic>> #FCE4EC {
  
  class Evaluation {
    +id: UUID
    +tenantId: UUID
    +coursId: UUID
    +periodeId: UUID
    +type: String
    +titre: String
    +description: String
    +date: Date
    +duree: Integer
    +noteMaximale: Decimal
    +poids: Decimal
    +coefficient: Decimal
    +bareme: String
    +consignes: String
    +estPubliee: Boolean
    +datePublication: DateTime
    --
    +estDansPeriode(): Boolean
    +publier(): void
    +calculerStatistiques(): Map
    +obtenirMoyenne(): Decimal
  }
  
  class Note {
    +id: UUID
    +tenantId: UUID
    +evaluationId: UUID
    +eleveId: UUID
    +valeur: Decimal
    +valeurSur20: Decimal
    +estAbsent: Boolean
    +commentaire: String
    +appreciation: String
    +dateSaisie: DateTime
    +dateModification: DateTime
    +saisiePar: UUID
    +modifiePar: UUID
    +estPubliee: Boolean
    +datePublication: DateTime
    --
    +estValide(): Boolean
    +normaliser(noteMax: Decimal): Decimal
    +calculerPourcentage(): Decimal
  }
  
  class Bulletin {
    +id: UUID
    +tenantId: UUID
    +eleveId: UUID
    +classeId: UUID
    +anneeScolaireId: UUID
    +periodeId: UUID
    +moyenneGenerale: Decimal
    +totalPoints: Decimal
    +totalCoefficients: Decimal
    +rang: Integer
    +effectifClasse: Integer
    +moyenneClasse: Decimal
    +moyennePremier: Decimal
    +moyenneDernier: Decimal
    +nombreAbsences: Integer
    +nombreRetards: Integer
    +nombreAbsencesJustifiees: Integer
    +heuresAbsence: Decimal
    +decision: String
    +mention: String
    +appreciationGenerale: String
    +appreciationChefEtablissement: String
    +appreciationConseilClasse: String
    +dateGeneration: DateTime
    +dateValidation: DateTime
    +datePublication: DateTime
    +estPublie: Boolean
    +estImprime: Boolean
    +urlPdf: String
    +generepar: UUID
    +validepar: UUID
    --
    +calculerMoyenne(): Decimal
    +calculerRang(): Integer
    +genererPDF(): String
    +estAdmis(): Boolean
    +publier(): void
    +imprimer(): ByteArray
    +obtenirAppreciations(): List
  }
  
  class AppreciationBulletin {
    +id: UUID
    +tenantId: UUID
    +bulletinId: UUID
    +groupeDisciplineId: UUID
    +moyenneGroupe: Decimal
    +totalPointsGroupe: Decimal
    +totalCoefficientsGroupe: Decimal
    +rangGroupe: Integer
    +moyenneClasseGroupe: Decimal
    +appreciation: String
    +appreciePar: UUID
    +dateAppreciation: DateTime
    --
    +calculerMoyenneGroupe(): Decimal
    +calculerRangGroupe(): Integer
  }
  
  Cours "1" o-- "0..*" Evaluation
  Periode "1" -- "0..*" Evaluation
  Evaluation "1" o-- "0..*" Note
  Eleve "1" -- "0..*" Note
  Enseignant "1" -- "0..*" Note
  
  Eleve "1" -- "0..*" Bulletin
  Periode "1" -- "0..*" Bulletin
  Classe "1" -- "0..*" Bulletin
  AnneeScolaire "1" -- "0..*" Bulletin
  
  Bulletin "1" *-- "0..*" AppreciationBulletin
  GroupeDiscipline "1" -- "0..*" AppreciationBulletin
  Enseignant "1" -- "0..*" AppreciationBulletin
}

package "Présences" <<Tracking>> #E0F2F1 {
  
  class PresenceEleve {
    +id: UUID
    +tenantId: UUID
    +coursId: UUID
    +eleveId: UUID
    +date: Date
    +statut: String
    +motif: String
    +justifiee: Boolean
    +documentJustificatif: String
    +heureArrivee: Time
    +minutesRetard: Integer
    +pointePar: UUID
    +datePointage: DateTime
    +validePar: UUID
    +dateValidation: DateTime
    +commentaire: String
    --
    +estAbsent(): Boolean
    +estJustifiee(): Boolean
    +justifier(document: String): void
    +calculerRetard(): Integer
  }
  
  class PointageEnseignant {
    +id: UUID
    +tenantId: UUID
    +enseignantId: UUID
    +date: Date
    +heureArrivee: Time
    +heureDepart: Time
    +statut: String
    +latitude: Double
    +longitude: Double
    +precision: Double
    +typeValidation: String
    +appareilId: String
    +adresseIP: String
    +commentaire: String
    --
    +calculerDureePresence(): Duration
    +estDansPerimetre(rayonMetres: Integer): Boolean
    +calculerHeuresSupplementaires(): Decimal
  }
  
  class DemandePermission {
    +id: UUID
    +tenantId: UUID
    +utilisateurId: UUID
    +type: String
    +dateDebut: Date
    +dateFin: Date
    +nombreJours: Integer
    +motif: String
    +documentJustificatif: String
    +statut: String
    +dateCreation: DateTime
    +dateValidation: DateTime
    +validePar: UUID
    +commentaireValidation: String
    +priorite: String
    --
    +valider(): void
    +refuser(motif: String): void
    +annuler(): void
    +calculerJoursOuvrables(): Integer
  }
  
  Cours "1" o-- "0..*" PresenceEleve
  Eleve "1" -- "0..*" PresenceEleve
  Enseignant "1" -- "0..*" PresenceEleve
  
  Enseignant "1" -- "0..*" PointageEnseignant
  
  Utilisateur "1" -- "0..*" DemandePermission
  AdminEcole "1" -- "0..*" DemandePermission
}

package "Communication" <<Messaging>> #E8EAF6 {
  
  class Conversation {
    +id: UUID
    +tenantId: UUID
    +titre: String
    +type: String
    +description: String
    +dateCreation: DateTime
    +dernierMessageDate: DateTime
    +nombreMessages: Integer
    +creePar: UUID
    +estArchivee: Boolean
    +estEpinglee: Boolean
    --
    +ajouterParticipant(utilisateur: Utilisateur): void
    +retirerParticipant(utilisateur: Utilisateur): void
    +archiver(): void
    +epingler(): void
  }
  
  class ConversationParticipant {
    +id: UUID
    +conversationId: UUID
    +utilisateurId: UUID
    +dateAjout: DateTime
    +estAdmin: Boolean
    +derniereLecture: DateTime
    +messagesNonLus: Integer
  }
  
  class Message {
    +id: UUID
    +tenantId: UUID
    +conversationId: UUID
    +expediteurId: UUID
    +contenu: String
    +typeContenu: String
    +dateEnvoi: DateTime
    +dateModification: DateTime
    +estLu: Boolean
    +dateLecture: DateTime
    +nombreLectures: Integer
    +pieceJointe: String
    +nomPieceJointe: String
    +taillePieceJointe: Integer
    +typeMime: String
    +estSupprime: Boolean
    +dateSuppression: DateTime
    --
    +marquerLu(utilisateur: Utilisateur): void
    +modifier(nouveauContenu: String): void
    +supprimer(): void
  }
  
  class Annonce {
    +id: UUID
    +tenantId: UUID
    +titre: String
    +contenu: String
    +cible: String
    +niveauxCibles: JSON
    +classesCibles: JSON
    +rolesDestinataires: JSON
    +priorite: String
    +datePublication: DateTime
    +dateExpiration: DateTime
    +creePar: UUID
    +dateCreation: DateTime
    +estPubliee: Boolean
    +estEpinglee: Boolean
    +pieceJointe: String
    +nombreVues: Integer
    --
    +publier(): void
    +depublier(): void
    +estActive(): Boolean
    +obtenirDestinataires(): List
  }
  
  class AppareilFirebase {
    +id: UUID
    +tenantId: UUID
    +utilisateurId: UUID
    +jetonFirebase: String
    +plateforme: String
    +modeleAppareil: String
    +fabricant: String
    +versionOS: String
    +versionApp: String
    +estActif: Boolean
    +dateEnregistrement: DateTime
    +derniereUtilisation: DateTime
    +derniereSynchronisation: DateTime
    --
    +renouvelerJeton(nouveauJeton: String): void
    +desactiver(): void
    +synchroniser(): void
  }
  
  class Notification {
    +id: UUID
    +tenantId: UUID
    +utilisateurId: UUID
    +type: String
    +titre: String
    +corps: String
    +donnees: JSON
    +urlAction: String
    +estLue: Boolean
    +dateCreation: DateTime
    +dateLecture: DateTime
    +estEnvoyee: Boolean
    +dateEnvoi: DateTime
    +estCliquee: Boolean
    +dateClick: DateTime
    +priorite: String
    --
    +marquerCommeLue(): void
    +envoyer(): void
    +marquerCliquee(): void
  }
  
  Conversation "1" *-- "0..*" Message
  Conversation "1" *-- "2..*" ConversationParticipant
  ConversationParticipant "0..*" -- "1" Utilisateur
  Utilisateur "1" -- "0..*" Message
  
  Tenant "1" *-- "0..*" Annonce
  Utilisateur "1" -- "0..*" Annonce
  
  Utilisateur "1" -- "0..*" AppareilFirebase
  Utilisateur "1" -- "0..*" Notification
}

package "Finance" <<Business>> #FFF9C4 {
  
  class Frais {
    +id: UUID
    +tenantId: UUID
    +nom: String
    +description: String
    +montant: Decimal
    +devise: String
    +frequence: String
    +estObligatoire: Boolean
    +typeFrais: String
    +categorieComptable: String
    +niveauId: UUID
    +anneeScolaireId: UUID
    +dateDebut: Date
    +dateFin: Date
    +dateEcheance: Date
    +estActif: Boolean
    --
    +estApplicable(eleve: Eleve): Boolean
    +calculerMontantProrate(dateInscription: Date): Decimal
  }
  
  class FraisEleve {
    +id: UUID
    +tenantId: UUID
    +eleveId: UUID
    +fraisId: UUID
    +montantInitial: Decimal
    +montant: Decimal
    +montantPaye: Decimal
    +montantRestant: Decimal
    +montantRemise: Decimal
    +pourcentageRemise: Decimal
    +motifRemise: String
    +dateEcheance: Date
    +statut: String
    +anneeScolaireId: UUID
    +periodeId: UUID
    +dateCreation: DateTime
    +dernierRappel: DateTime
    +nombreRappels: Integer
    --
    +calculerSolde(): Decimal
    +estSoldee(): Boolean
    +appliquerRemise(montant: Decimal, motif: String): void
    +estEnRetard(): Boolean
    +genererEcheancier(): List
  }
  
  class Transaction {
    +id: UUID
    +tenantId: UUID
    +fraisEleveId: UUID
    +montant: Decimal
    +montantAvantTransaction: Decimal
    +montantApresTransaction: Decimal
    +methodePaiement: String
    +numeroReference: String
    +numeroRecu: String
    +dateTransaction: DateTime
    +dateComptabilisation: DateTime
    +statut: String
    +recuPar: UUID
    +validePar: UUID
    +dateValidation: DateTime
    +commentaire: String
    +pieceJustificative: String
    --
    +genererRecu(): Recu
    +valider(): void
    +annuler(motif: String): void
    +comptabiliser(): void
  }
  
  class Recu {
    +id: UUID
    +tenantId: UUID
    +transactionId: UUID
    +numeroRecu: String
    +montant: Decimal
    +montantEnLettres: String
    +dateEmission: DateTime
    +emetPar: UUID
    +eleveNom: String
    +eleveMatricule: String
    +motif: String
    +urlPdf: String
    +estAnnule: Boolean
    +dateAnnulation: DateTime
    +motifAnnulation: String
    +estImprime: Boolean
    +dateImpression: DateTime
    --
    +genererPDF(): String
    +imprimer(): ByteArray
    +annuler(motif: String): void
    +envoyer(email: String): void
  }
  
  Tenant "1" *-- "0..*" Frais
  Niveau "0..*" -- "0..1" Frais
  AnneeScolaire "1" -- "0..*" Frais
  
  Eleve "1" -- "0..*" FraisEleve
  Frais "1" -- "0..*" FraisEleve
  
  FraisEleve "1" o-- "0..*" Transaction
  Utilisateur "1" -- "0..*" Transaction
  
  Transaction "1" -- "1" Recu
}

package "Transport" <<Logistics>> #B2EBF2 {
  
  class Bus {
    +id: UUID
    +tenantId: UUID
    +numeroPlaques: String
    +marque: String
    +modele: String
    +capacite: Integer
    +anneeFabrication: Integer
    +couleur: String
    +numeroChassisVIN: String
    +chauffeurId: UUID
    +telephoneChauffeur: String
    +statut: String
    +dateAssurance: Date
    +compagnieAssurance: String
    +numeroPolice: String
    +dateVisite: Date
    +kmParcourus: Integer
    +dateAcquisition: Date
    +dateProchaineMaintenance: Date
    +coutAcquisition: Decimal
    --
    +estDisponible(): Boolean
    +estEnRegle(): Boolean
    +programmerMaintenance(date: Date): void
    +calculerAge(): Integer
  }
  
  class Trajet {
    +id: UUID
    +tenantId: UUID
    +busId: UUID
    +nom: String
    +description: String
    +heureDepart: Time
    +heureArrivee: Time
    +type: String
    +joursSemaine: JSON
    +estActif: Boolean
    +distanceKm: Decimal
    +dureeEstimee: Integer
    +capaciteMax: Integer
    +nombreInscrits: Integer
    --
    +calculerDuree(): Integer
    +obtenirProchainArret(heureActuelle: Time): ArretBus
    +estComplet(): Boolean
    +estAujourdui(): Boolean
  }
  
  class ArretBus {
    +id: UUID
    +tenantId: UUID
    +trajetId: UUID
    +nom: String
    +adresse: String
    +quartier: String
    +latitude: Double
    +longitude: Double
    +ordrePassage: Integer
    +heurePassage: Time
    +dureeArret: Integer
    +pointRepere: String
    --
    +calculerDistance(autre: ArretBus): Decimal
    +estProche(lat: Double, lon: Double, rayonMetres: Integer): Boolean
  }
  
  class TrajetEleve {
    +id: UUID
    +tenantId: UUID
    +eleveId: UUID
    +trajetId: UUID
    +arretBusId: UUID
    +montantMensuel: Decimal
    +dateDebut: Date
    +dateFin: Date
    +estActif: Boolean
    +estPaye: Boolean
    +dateActivation: DateTime
    +dateDesactivation: DateTime
    --
    +activer(): void
    +desactiver(): void
    +verifierPaiement(): Boolean
  }
  
  class PresenceTransport {
    +id: UUID
    +tenantId: UUID
    +eleveId: UUID
    +trajetId: UUID
    +date: Date
    +statut: String
    +direction: String
    +heurePointage: Time
    +arretBusId: UUID
    +pointePar: UUID
    +latitude: Double
    +longitude: Double
    +commentaire: String
    +parentNotifie: Boolean
    +dateNotification: DateTime
    --
    +estPresent(): Boolean
    +notifierParent(): void
  }
  
  class PositionBus {
    +id: UUID
    +tenantId: UUID
    +busId: UUID
    +trajetId: UUID
    +latitude: Double
    +longitude: Double
    +vitesse: Double
    +cap: Double
    +altitude: Double
    +precision: Double
    +dateHeure: DateTime
    +prochainArretId: UUID
    +distanceProchainArret: Decimal
    +tempEstimeArrivee: Integer
    +estEnCours: Boolean
    --
    +estDansZone(arret: ArretBus, rayonMetres: Integer): Boolean
    +calculerDistance(lat: Double, lon: Double): Decimal
    +estimerArrivee(arret: ArretBus): DateTime
    +calculerVitesseMoyenne(): Decimal
  }
  
  Tenant "1" *-- "0..*" Bus
  AgentTransport "0..*" -- "0..1" Bus
  
  Bus "1" -- "0..*" Trajet
  Trajet "1" *-- "2..*" ArretBus
  
  Eleve "1" -- "0..*" TrajetEleve
  Trajet "1" -- "0..*" TrajetEleve
  ArretBus "1" -- "0..*" TrajetEleve
  
  Eleve "1" -- "0..*" PresenceTransport
  Trajet "1" -- "0..*" PresenceTransport
  AgentTransport "1" -- "0..*" PresenceTransport
  
  Bus "1" -- "0..*" PositionBus
  Trajet "0..*" -- "0..1" PositionBus
}

package "Bibliothèque" <<Library>> #F8BBD0 {
  
  class Livre {
    +id: UUID
    +tenantId: UUID
    +titre: String
    +auteur: String
    +isbn: String
    +editeur: String
    +annePublication: Integer
    +categorie: String
    +sousCategorie: String
    +nombreExemplaires: Integer
    +exemplairesDisponibles: Integer
    +exemplairesEmpruntes: Integer
    +emplacement: String
    +etagere: String
    +rayonnage: String
    +langue: String
    +nombrePages: Integer
    +resume: String
    +imageCouverte: String
    +prixAchat: Decimal
    +dateAcquisition: Date
    +estActif: Boolean
    --
    +estDisponible(): Boolean
    +reserver(): void
    +incrementerExemplaires(nombre: Integer): void
    +decrementerExemplaires(nombre: Integer): void
  }
  
  class PretLivre {
    +id: UUID
    +tenantId: UUID
    +livreId: UUID
    +eleveId: UUID
    +datePret: Date
    +dateRetourPrevue: Date
    +dateRetourEffective: Date
    +statut: String
    +prolongations: Integer
    +montantAmende: Decimal
    +amendePayee: Boolean
    +pretePar: UUID
    +retourEnregistrePar: UUID
    +commentaire: String
    --
    +estEnRetard(): Boolean
    +calculerAmende(): Decimal
    +prolonger(joursSupplementaires: Integer): void
    +enregistrerRetour(): void
  }
  
  Tenant "1" *-- "0..*" Livre
  Livre "1" -- "0..*" PretLivre
  Eleve "1" -- "0..*" PretLivre
  Bibliothecaire "1" -- "0..*" PretLivre
}

@enduml

